{
    # Enable FrankenPHP
    frankenphp
    # Disable admin API for security
    admin off
}

# Listen on PORT environment variable (Railway will set this)
:{$PORT:8080} {
    # Set the webroot to the public/ directory
    root * public/
    
    # Enable compression
    encode zstd gzip
    
    # Handle PHP files with FrankenPHP
    php_server
    
    # File server for static assets
    file_server
    
    # Security headers
    header {
        # Prevent MIME type sniffing
        X-Content-Type-Options "nosniff"
        # Prevent clickjacking
        X-Frame-Options "SAMEORIGIN"
        # XSS protection
        X-XSS-Protection "1; mode=block"
        # Referrer policy
        Referrer-Policy "strict-origin-when-cross-origin"
    }
    
    # Serve static files with caching
    @static {
        file
        path *.ico *.css *.js *.gif *.jpg *.jpeg *.png *.svg *.woff *.woff2 *.ttf *.eot *.webp
    }
    header @static {
        Cache-Control "public, max-age=31536000, immutable"
    }
    
    # Health check endpoint
    handle /health {
        respond "OK" 200
    }
    
    # Laravel index.php fallback
    try_files {path} {path}/ /index.php?{query}
    
    # Logging
    log {
        output stdout
        format console
        level INFO
    }
}